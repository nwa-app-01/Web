@using System.Xml.Linq;
@{
    ViewBag.Title = "Data Documents";
}

<div>
    <div data-bind="tabs: { options: { active: 1 } }">
        <ul>
            <li>
                <a href="#tab-documents">Documents</a>
            </li>
            <li>
                <a href="#tab-templates">Templates</a>
            </li>
            <li>
                <a href="#tab-messages">Messages</a>
            </li>
            <li>
                <a href="#tab-generate">Generate</a>
            </li>
        </ul>
        <div id="tab-documents">
            <div class="ui-widget">Select a document for editing :</div>
            <table class="defaultTable">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th style="text-align:right">Select</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- ko foreach: documents -->
                    <tr>
                        <td data-bind="text: Name" ></td>
                        <td style="text-align:right;">
                            <button style="font-size:0.85em;" data-bind="click: function () { window.location.href = '@Url.Action("Edit")/' + Id(); }, button: { text: false, icons: { primary: 'ui-icon-check' } }">select</button>
                        </td>
                    </tr>
                    <!-- /ko -->
                </tbody>
            </table>
        </div>
        <div id="tab-templates">
            <div class="ui-widget">Select a document tempate to create from :</div>
            <table class="defaultTable">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th style="text-align:right">Select</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- ko foreach: documentTemplates -->
                    <tr>
                        <td data-bind="text: TemplateName" ></td>
                        <td style="text-align:right;">
                            <button style="font-size:0.85em;" data-bind="click: $root.openCreateDocumentDialog, button: { text: false, icons: { primary: 'ui-icon-plus' } }">create</button>
                        </td>
                    </tr>
                    <!-- /ko -->
                </tbody>
            </table>
            <div style="height:2em;"></div>
            <button style="font-size:0.85em;" data-bind="click: $root.openCreateTemplateDialog, button: { text: true, icons: { primary: 'ui-icon-plus' } }">Create a new Template</button>
        </div>
        <div id="tab-messages">
            <table style="font-size: 0.85em;">
                <thead>
                    <tr>
                        <th style="width: 250px;">Date</th>
                        <th>Message</th>
                    </tr>
                </thead>
                <tbody id="messages">

                </tbody>
            </table>
        </div>
        <div id="tab-generate">
            <div>Generate</div>
        </div>
        </div>
    <div>
        <table stye="defaultTable" style="font-size: 0.85em; color:green;">
            <tbody>
                <!-- ko foreach: userMessages -->
                <tr>
                    <td data-bind="text: $data"></td>
                </tr>
                <!-- /ko --> 
            </tbody>
        </table>
    </div>

    <!-- ko with: createDocumentDialog -->
    <div id="createDocumentDialog" style="display: none" data-bind="dialog: {
            autoOpen: false,
            title: 'Create Document',
            isOpen: isOpen,
            closeOnEscape: true, height: 400, width: 500, modal: true,
            buttons: {
                'Save': $root.createDocument,
                'Cancel': function () {
                    $(this).dialog('close');
                }
            }
        }">
        <div style="vertical-align:central">
            <div class="ui-widget">Document Name to create :</div>
            <input type="text" style="width: 95%;" data-bind="value: name" />
        </div>
    </div>
    <!-- /ko --> 

    <!-- ko with: createTemplateDialog -->
    <div id="createTemplateDialog" style="display: none" data-bind="dialog: {
            autoOpen: false,
            title: 'Create Template',
            isOpen: isOpen,
            closeOnEscape: true, height: 400, width: 500, modal: true,
            buttons: {
                'Save': $root.createTemplateDocument,
                'Cancel': function () {
                    $(this).dialog('close');
                }
            }
        }">
        <div style="vertical-align:central">
            <div class="ui-widget">Template Name to create :</div>
            <input type="text" style="width: 95%;" data-bind="value: name" />
        </div>
    </div>
    <!-- /ko --> 
</div>


@section scripts {
    <script src='@Url.Content("~/Scripts/moment.min.js")' type="text/javascript"></script>
    <script src='@Url.Content("~/Scripts/Views/index.js")' type="text/javascript"></script>
    <script type="text/javascript">
        $(function () {
            var messageTarget = $("#messages");
            var config = new Index.VMConfig({
                baseUrl: '@Url.Content("~/api")',
                message: function (m) {
                    messageTarget.append("<tr><td>" + moment().format('DD-MMM-YYYY HH:MM:SS') + "</td><td>" + m + "</td></tr>")
                },
                messageClear: function () {
                    messageTarget.empty("tr");
                }
            })

            var pageViewModel = new Index.VM(config);
            config.message('model initializing');
            $.when(
                pageViewModel.initialize().then(function () {
                    config.message('model initialized');
                })
            ).then(function () {
                config.message('data bind started');
                ko.applyBindings(pageViewModel);
                config.message('data bind complete');
            });

        });
    </script>
}

@section styles {
    .defaultTable {
	    border-collapse: collapse;
        width: 100%;
        white-space:nowrap;
	}

    .defaultTable td {
        padding: 0em 0em 0em 0em;
    }

    .defaultTable .ui-button-text {
        padding-top: 0; padding-bottom: 0;
    }
    
    padding: 0.25em 2em 0.25em 0em;
    /*
    .defaultTable tbody tr:nth-child(even) {
       background-color: wheat;
    }
    .defaultTable tbody tr:nth-child(odd) {
       background-color: palegoldenrod;
    }
    */
    .defaultTable td+td {
	    border-left: 1px solid #CCC;
	}

}